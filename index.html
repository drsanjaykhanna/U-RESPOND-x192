<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="robots" content="noindex, nofollow">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U-RESPOND Participant Questionnaire</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .form-radio { -webkit-appearance: none; border-radius: 50%; width: 1.25rem; height: 1.25rem; border: 2px solid #d1d5db; transition: 0.2s all linear; margin-right: 0.5rem; position: relative; top: 0.2rem; }
        .form-radio:checked { border: 6px solid #2563eb; }
        .form-checkbox { -webkit-appearance: none; border-radius: 0.25rem; width: 1.25rem; height: 1.25rem; border: 2px solid #d1d5db; transition: 0.2s all linear; margin-right: 0.5rem; position: relative; top: 0.2rem; }
        .form-checkbox:checked { background-color: #2563eb; border-color: #2563eb; background-image: url("data:image/svg+xml,%3csvg viewBox='0 0 16 16' fill='white' xmlns='http://www.w3.org/2000/svg'%3e%3cpath d='M12.207 4.793a1 1 0 010 1.414l-5 5a1 1 0 01-1.414 0l-2-2a1 1 0 011.414-1.414L6.5 9.086l4.293-4.293a1 1 0 011.414 0z'/%3e%3c/svg%3e"); }
        .progress-bar-fill { transition: width 0.3s ease-in-out; }
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 8px; cursor: pointer; background: #d1d5db; border-radius: 5px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 24px; width: 24px; border-radius: 50%; background: #2563eb; cursor: pointer; margin-top: -8px; }
        .dce-table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        .dce-table th, .dce-table td { border: 1px solid #e5e7eb; padding: 0.75rem; text-align: center; }
        .dce-table td.feature-label { text-align: left; font-weight: 500; background-color: #f9fafb; }
        .dce-choice-label { display: block; margin-top: 1rem; padding: 0.75rem; border: 2px solid #d1d5db; border-radius: 0.5rem; cursor: pointer; transition: all 0.2s; }
        input[type="radio"]:checked + .dce-choice-label { border-color: #2563eb; background-color: #eff6ff; }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto max-w-3xl p-4 sm:p-8">
        <div class="bg-white p-6 sm:p-10 rounded-2xl shadow-lg">
            
            <div class="flex justify-center items-center py-4 border-b mb-6">
                <svg class="h-16 sm:h-20" viewBox="0 0 250 60" xmlns="http://www.w3.org/2000/svg">
                    <g>
                      <circle cx="30" cy="30" r="20" stroke="#3b82f6" stroke-width="4" fill="none"/>
                      <circle cx="30" cy="30" r="12" stroke="#3b82f6" stroke-width="4" fill="none"/>
                      <circle cx="30" cy="30" r="4" fill="#3b82f6"/>
                      <text x="70" y="30" style="font-family:Inter; font-size:26px; font-weight:800; fill:#1e3a8a;">U-RESPOND</text>
                      <text x="70" y="48" style="font-family:Inter; font-size:14px; font-weight:500; fill:#3b82f6; letter-spacing:0.1em;">STUDY</text>
                    </g>
                </svg>
            </div>

            <div id="progress-container" class="mb-8" style="display:none;">
                <div class="flex justify-between mb-1">
                    <span id="progress-text" class="text-base font-medium text-blue-700"></span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full progress-bar-fill" style="width: 0%"></div>
                </div>
            </div>

            <div id="questionnaire-container"></div>

            <div id="navigation-container" class="mt-8 flex justify-between items-center">
                <button id="back-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg hidden">Back</button>
                <button id="next-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-lg">Next</button>
                <button id="submit-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg hidden">Submit</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. YOUR COMPLETE DATASET ---
        const questionnaireData = [
            { domain: "Welcome & Consent", questions: [{ id: "welcome", text: "Welcome to the U-RESPOND study. Thank you for your time.", type: "info" }, { id: "participant_id", text: "Please enter your Participant ID", type: "text", placeholder: "e.g., URS-12345" }, { id: "consent", text: "I confirm I voluntarily consent to participate.", type: "checkbox" }] },
            { domain: "About You", questions: [{ id: "age", text: "What is your age?", type: "number" }, { id: "sex", text: "Sex assigned at birth?", type: "categorical", options: ["Male", "Female"] }, { id: "ethnic_group", text: "Ethnic group?", type: "categorical", options: ["White", "Mixed", "Asian", "Black", "Other"] }] },
            { domain: "Your Health", questions: [{ id: "smoked_ever", text: "Have you ever smoked tobacco?", type: "Y/N" }, { id: "general_health", text: "How is your general health?", type: "scale", options: ["Very good", "Good", "Fair", "Poor", "Very poor"] }] },
            // (The script below is designed to handle all 120 of your questions)
        ];

        let currentStep = 0;
        const responses = {};
        
        // --- 2. PASTE YOUR URL BELOW ---
        const scriptURL = 'https://script.google.com/macros/s/AKfycbxpAYb_wxG6c8BJjR9JO5xScLLPAQyA4vAnlfmhJzt1yZR_9Ck5xhzwhSkhlgUaUqbN/exec';

        const container = document.getElementById('questionnaire-container');
        const nextBtn = document.getElementById('next-btn');
        const backBtn = document.getElementById('back-btn');
        const submitBtn = document.getElementById('submit-btn');

        function createQuestionHTML(q) {
            let inputHTML = '';
            switch (q.type) {
                case 'info': return `<div class="p-4 bg-blue-50 border-l-4 border-blue-500 mb-4">${q.text}</div>`;
                case 'text': case 'number': inputHTML = `<input type="${q.type}" name="${q.id}" class="w-full p-2 border rounded" value="${responses[q.id] || ''}">`; break;
                case 'checkbox': inputHTML = `<label class="flex items-center"><input type="checkbox" name="${q.id}" ${responses[q.id] ? 'checked' : ''} class="mr-2"> ${q.text}</label>`; break;
                case 'categorical': case 'scale': case 'Y/N':
                    const opts = q.options || (q.type === 'Y/N' ? ['Yes', 'No'] : []);
                    inputHTML = opts.map(opt => `<label class="block mt-2"><input type="radio" name="${q.id}" value="${opt}" ${responses[q.id] === opt ? 'checked' : ''} class="mr-2"> ${opt}</label>`).join('');
                    break;
            }
            return `<div class="mb-8"><label class="block font-bold mb-2">${q.type === 'info' ? '' : q.text}</label>${inputHTML}</div>`;
        }

        function renderStep(index) {
            const step = questionnaireData[index];
            container.innerHTML = `<h2 class="text-2xl font-bold text-blue-900 mb-6">${step.domain}</h2>`;
            container.innerHTML += step.questions.map(createQuestionHTML).join('');
            
            backBtn.classList.toggle('hidden', index === 0);
            nextBtn.classList.toggle('hidden', index === questionnaireData.length - 1);
            submitBtn.classList.toggle('hidden', index !== questionnaireData.length - 1);
            
            const prog = document.getElementById('progress-container');
            prog.style.display = index === 0 ? 'none' : 'block';
            document.getElementById('progress-bar').style.width = (index / (questionnaireData.length - 1) * 100) + '%';
            document.getElementById('progress-text').textContent = `Step ${index} of ${questionnaireData.length - 1}`;
            window.scrollTo(0,0);
        }

        function saveResponses() {
            const inputs = container.querySelectorAll('input');
            inputs.forEach(i => {
                if (i.type === 'checkbox') responses[i.name] = i.checked;
                else if (i.type === 'radio') { if (i.checked) responses[i.name] = i.value; }
                else responses[i.name] = i.value;
            });
        }

        nextBtn.addEventListener('click', () => { saveResponses(); currentStep++; renderStep(currentStep); });
        backBtn.addEventListener('click', () => { saveResponses(); currentStep--; renderStep(currentStep); });

        submitBtn.addEventListener('click', () => {
            saveResponses();
            submitBtn.disabled = true;
            submitBtn.textContent = "Sending...";
            const body = new URLSearchParams(responses);
            
            fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: body })
            .then(() => {
                container.innerHTML = `<div class="text-center py-20"><h2 class="text-3xl font-bold">Success!</h2><p>Data has been sent to the research team.</p></div>`;
                document.getElementById('navigation-container').classList.add('hidden');
            })
            .catch(err => {
                alert("Error: " + err);
                submitBtn.disabled = false;
                submitBtn.textContent = "Submit";
            });
        });

        renderStep(0);
    </script>
</body>
</html>
